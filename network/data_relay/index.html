<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="University of Waterloo Aerial Robotics Group">
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <title>Data Relay - WARG Docs</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Data Relay";
    var mkdocs_page_input_path = "network/data_relay.md";
    var mkdocs_page_url = "/network/data_relay/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68186801-2', 'docs.uwarg.com');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> WARG Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Bootcamps</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../bootcamp/mechanical/">Mechanical</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/computer-vision/">Computer Vision</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/electrical/">Electrical</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/groundstation/">Groundstation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/embedded/">Embedded Software</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/rccompetition/">RC Car Competition</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorials</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../tutorials/git/">Git and Github</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tutorials/shell/">Using the terminal</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Groundstation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../groundstation/">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/what-you-need-to-know/">What you need to know</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/installation/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/tutorial/">Tutorial</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/project-structure/">Project Structure</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/contributing/">Contributing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/documenting/">Documenting</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/resources/">Additional Resources</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">ZeroPilot</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../zeropilot/">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../zeropilot/pinout_reference/">Pinout Reference</a>
                </li>
                <li class="">
                    
    <a class="" href="../../zeropilot/hardware/">Hardware</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Network</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">Data Relay</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#data-relay">Data Relay</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#purpose">Purpose</a></li>
        
            <li><a class="toctree-l4" href="#setup">Setup</a></li>
        
            <li><a class="toctree-l4" href="#manually-sending-commands">Manually Sending Commands</a></li>
        
            <li><a class="toctree-l4" href="#simulator">Simulator</a></li>
        
            <li><a class="toctree-l4" href="#network-connection">Network Connection</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../multi_echo/">Multi Echo</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Computer Vision</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../computer-vision/">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Installation/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Building-the-project-[Linux]/">Building the project [Linux]</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Building-the-project-[Windows]/">Building the project [Windows]</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Coding-Conventions/">Coding Conventions</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Contributing/">Contributing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Using-the-WARG-server-environment/">Using the WARG computer environment</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Writing-Tests/">Writing Tests</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Mechanical</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../mechanical/">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanical/cad-guidelines/">CAD Guidelines</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanical/3d-printing-guidelines/">3D Printing Guidelines</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanical/grabcad/">GrabCad</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">PicPilot</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../picpilot/">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/pid-loops/">PID Loops</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/pwm-io/">PWM and IO</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/uart/">UART</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/spi/">SPI</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/direct-memory-access/">Direct Memory Access</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/i2c/">I2C</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/datalink/">Datalink</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/analog-to-digital-converter/">Analog to Digital Converter</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/sensors-and-peripherals/">Sensors and Peripherals</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/attitude-control/">Attitude Control</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/path-management/">Path Management</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/resources/">Resources</a>
                </li>
                <li class="">
                    
    <a class="" href="../../picpilot/faq/">FAQ</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">WARG Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Network &raquo;</li>
        
      
    
    <li>Data Relay</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/UWARG/edit/master/docs/network/data_relay.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="data-relay">Data Relay</h1>
<h2 id="purpose">Purpose</h2>
<p>The data relay is a python script that can run on any computer and is primarly run on Raspberry Pi. It is the communication link with the vehicles and the ground stations. It communicates with XBees over a serial USB connection to receive and transmit data like commands from the ground station and telemetry coming from the UAV. The relay has a TCP connection over its network to communicate with various ground devices such as ground stations, tracking antennas, computer vision software, and WARG's android app. The benefit of this system is to allow multiple planes to communicate with multiple ground stations to give flexibility and redundancy.</p>
<p>Separating the ground station from the data relay makes our system safer by ensuring the plane will still fly if a ground station fails. If the ground station fails for any reason, another ground station can take its place and continue the UAV flight. To get write access, the ground stations sends 'commander' to the ground station over the TCP connection. This extra step ensure that other applications connected to the data relay will never accidentally send a command to the plane.</p>
<h2 id="setup">Setup</h2>
<p>The installation instructions can be found in the <a href="https://github.com/UWARG/data-relay-station">github README.md</a>. These setup instructions will assist you in setting up the Raspberry Pi to run the data relay</p>
<h3 id="1-setup-the-hardware">1. Setup the Hardware</h3>
<p>Step 1... plug in the device (duh). Connect power to the Raspberry Pi. Either plug in an ethernet cable to the Pi's ethernet port or connect it to the Wifi network. Plug in the XBee via USB cable unless you are planning to just use the Xbee simulator.</p>
<h3 id="2-connecting-the-the-raspberry-pi">2. Connecting the the Raspberry Pi</h3>
<p>There are multiple ways to connect to the Raspberry Pi:</p>
<p>The easiest way to start the data relay script is to plug in a monitor and keyboard to the Pi. A terminal window will appear where you can run commands and start the script from.</p>
<p>An SSH connection is helpful and is what is usually used on the flight line to connect to the Raspberry Pi. To do this, type the following command:</p>
<p><code>ssh root@192.168.1.103</code>
The IP address might be slightly different, and depending on the type of Raspberry Pi it might be <code>pi@[IP address]</code>.</p>
<p>If you do this method, type <code>screen</code> as the first command. This will make sure the script will still run even if the ssh connection breaks.</p>
<p>You can also setup the raspberry Pi to start the python script on startup so you don't need to connect to it at all. There are multiple ways to do this and currently have some issues, so this will be documented once a good method is figured out.</p>
<h3 id="3-running-the-script">3. Running the script</h3>
<p>Assuming the script isn't configured to run on startup, use the following command to start the data relay:</p>
<p>If you used ssh, first use the <code>screen</code> command.</p>
<p>Use the command <code>python data_relay.py</code>. If it started correctly, it should print out <code>writing headers</code></p>
<p>To see what options are available, use <code>python data_relay.py -h</code> to view all the possible parameters</p>
<h2 id="manually-sending-commands">Manually Sending Commands</h2>
<p>The data relay can recieve commands in 2 ways. The normal way to send commands is through the ground station, using a TCP network connection. However, there is a way to manually send it commands from the data relay computer.</p>
<p>Once the script is started, a command prompt should come up, starting with <code>(Cmd)</code>. To manually send a command, type <code>cmd</code> then type the command you want, or press tab to view possible commands. Send any command data after the colon. To view the format of the commands, view the <code>commands.py</code> file.</p>
<h2 id="simulator">Simulator</h2>
<p>The data relay has the ability to run without an Xbee connected for debuggin purposes. It uses a csv file to print out data from a previous flight to simlate plane data. Use the --simfile parameter to use the simulator:</p>
<p><code>python data_relay.py --simfile FILENAME.csv</code></p>
<p>The data relay can also simulate the XBee link to the autopilot system using a USB-uart dongle. Connect a USB-uart dongle from the data relay computer to the XBee port on the autopilot board. Use the --uart command to enable this feature:
<code>python data_relay.py --uart</code></p>
<h2 id="network-connection">Network Connection</h2>
<p>The data relay communicates to ground stations and other apps using a TCP connection. To enable ground stations to find the data relay computer without needing its IP address, the ground station broadcasts on a UDP connection to see if there are any data relays on the network. The data relay will respond to the UDP broadcast with a UDP packet to the IP address of the broadcast. The packet will include the IP address and port number of the data relay. The port number can also be seen in the data relay logs in the terminal. After this, the ground station will connect to the TCP connection. The TCP connection is more stable than a UDP connection and has a handshake protocol to make sure the ground station is connected to the data relay.</p>
<p>The data relay can use just the TCP mode if the UDP connection is unwanted. The legacy TCP information is below. Use --legacy_port to enable this:</p>
<p><code>IP: 192.168.1.103
Port: 1234</code></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../multi_echo/" class="btn btn-neutral float-right" title="Multi Echo">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../zeropilot/hardware/" class="btn btn-neutral" title="Hardware"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright <a href="http://www.uwarg.com"> University of Waterloo Aerial Robotics Group</a></p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/UWARG/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../zeropilot/hardware/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../multi_echo/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>
      <script src="../../sloth-generator.js"></script>

</body>
</html>
