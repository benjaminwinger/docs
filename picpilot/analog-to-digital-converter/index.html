<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="University of Waterloo Aerial Robotics Group">
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <title>Analog to Digital Converter - WARG Docs</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Analog to Digital Converter";
    var mkdocs_page_input_path = "picpilot/analog-to-digital-converter.md";
    var mkdocs_page_url = "/picpilot/analog-to-digital-converter/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68186801-2', 'docs.uwarg.com');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> WARG Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Bootcamps</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../bootcamp/mechanical/">Mechanical</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/computer-vision/">Computer Vision</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/electrical/">Electrical</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/groundstation/">Groundstation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/embedded/">Embedded Software</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/rccompetition/">RC Car Competition</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorials</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../tutorials/git/">Git and Github</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tutorials/shell/">Using the terminal</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Groundstation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../groundstation/">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/what-you-need-to-know/">What you need to know</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/installation/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/tutorial/">Tutorial</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/project-structure/">Project Structure</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/contributing/">Contributing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/documenting/">Documenting</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/resources/">Additional Resources</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">ZeroPilot</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../zeropilot/">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../zeropilot/pinout_reference/">Pinout Reference</a>
                </li>
                <li class="">
                    
    <a class="" href="../../zeropilot/hardware/">Hardware</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Network</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../network/data_relay/">Data Relay</a>
                </li>
                <li class="">
                    
    <a class="" href="../../network/multi_echo/">Multi Echo</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Computer Vision</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../computer-vision/">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Installation/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Building-the-project-[Linux]/">Building the project [Linux]</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Building-the-project-[Windows]/">Building the project [Windows]</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Coding-Conventions/">Coding Conventions</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Contributing/">Contributing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Using-the-WARG-server-environment/">Using the WARG computer environment</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Writing-Tests/">Writing Tests</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Mechanical</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../mechanical/">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanical/cad-guidelines/">CAD Guidelines</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanical/3d-printing-guidelines/">3D Printing Guidelines</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanical/grabcad/">GrabCad</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">PicPilot</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../pid-loops/">PID Loops</a>
                </li>
                <li class="">
                    
    <a class="" href="../pwm-io/">PWM and IO</a>
                </li>
                <li class="">
                    
    <a class="" href="../uart/">UART</a>
                </li>
                <li class="">
                    
    <a class="" href="../spi/">SPI</a>
                </li>
                <li class="">
                    
    <a class="" href="../direct-memory-access/">Direct Memory Access</a>
                </li>
                <li class="">
                    
    <a class="" href="../i2c/">I2C</a>
                </li>
                <li class="">
                    
    <a class="" href="../datalink/">Datalink</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Analog to Digital Converter</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#analog-to-digital-converter">Analog to Digital Converter</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#in-the-code">In the code</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../sensors-and-peripherals/">Sensors and Peripherals</a>
                </li>
                <li class="">
                    
    <a class="" href="../attitude-control/">Attitude Control</a>
                </li>
                <li class="">
                    
    <a class="" href="../path-management/">Path Management</a>
                </li>
                <li class="">
                    
    <a class="" href="../resources/">Resources</a>
                </li>
                <li class="">
                    
    <a class="" href="../faq/">FAQ</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">WARG Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>PicPilot &raquo;</li>
        
      
    
    <li>Analog to Digital Converter</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/UWARG/edit/master/docs/picpilot/analog-to-digital-converter.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="analog-to-digital-converter">Analog to Digital Converter</h1>
<p>The Analog to Digital Converter (ADC) on the PICpilot is used for a single purpose, which to monitor and report the battery life remaining for the vehicle and/or the autopilot. The path managing chip is responsible for measuring the battery voltage. Based on the reference voltage, a percentage is determined which indicates the voltage measured in relationship to the reference voltage. This data is transmitted to the attitude manager chip and then it is transmitted wirelessly along with the telemetry data.</p>
<p>The functionality of the ADC is fairly straightforward. The ADC module switches between two states. One of which is the sampling period, whereas the other is the conversion period. During the conversion period, no sampling is performed. Instead, the previously captured data is converted into a 12 bit number. Therefore, in order to attain the voltage percent, you simply divide the data by 4096, the largest possible 12 bit number.</p>
<p>In the PICpilot, the ADC module is triggered through interrupts (although it can also be manually polled).</p>
<h2 id="in-the-code">In the code</h2>
<p>All the code for the voltage sensor is available in the <em>voltageSensor.c</em> and <em>.h</em> files. The code which controls the ADC module is extremely straight forward. The process mostly involves initializations. Most of the "magic" is handled automatically by the module, therefore minimal logical coding is required. A few of the important lines have been included below:</p>
<pre><code>AD1CON1bits.FORM = 0;                // Data Output Format: Unsigned Int

AD1CON1bits.SSRC = 7;                // Internal Counter (SAMC) ends sampling and starts conversion

AD1CON1bits.AD12B = 1;                // 12-bit single channel operation

AD1CON1bits.SAMP = 1;

AD1CON2bits.SMPI=0;                        // Interrupt address every sample/conversion

AD1CON2bits.CHPS = 0;                //We are using channel 0

AD1CON2bits.VCFG = 0;                 //Voltage Reference is 3.3V and Ground Reference is Ground

AD1CON3bits.SAMC=0;                         // Auto Sample Time = 0\*Tad

AD1CON3bits.ADCS=6;                        // ADC Conversion Clock Tad=Tcy\*(ADCS+1)= (1/40M)\*7 = 175nS



AD1CHS0bits.CH0SA = 0xC;                 //Channel 0 positive input on AN12 (Sample A)

AD1CHS0bits.CH0SB = 0xC;                 //Channel 0 positive input on AN12 (Sample B)

IFS0bits.AD1IF = 0;                        // Clear the A/D interrupt flag bit

IEC0bits.AD1IE = 1;                        // Enable A/D interrupt

AD1CON1bits.ADON = 1;                // Turn on the A/D converter
</code></pre>
<p>After each interrupt, the battery voltage is updated into the <em>currentSignal</em> variable. When the battery voltage is requested, this integer is multiplied by 100 and divided by 4096 to get a percentage (4096 is 12 bits of data).</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../sensors-and-peripherals/" class="btn btn-neutral float-right" title="Sensors and Peripherals">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../datalink/" class="btn btn-neutral" title="Datalink"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright <a href="http://www.uwarg.com"> University of Waterloo Aerial Robotics Group</a></p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/UWARG/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../datalink/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../sensors-and-peripherals/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>
      <script src="../../sloth-generator.js"></script>

</body>
</html>
