<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="University of Waterloo Aerial Robotics Group">
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <title>UART - WARG Docs</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "UART";
    var mkdocs_page_input_path = "picpilot/uart.md";
    var mkdocs_page_url = "/picpilot/uart/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68186801-2', 'docs.uwarg.com');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> WARG Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Bootcamps</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../bootcamp/mechanical/">Mechanical</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/computer-vision/">Computer Vision</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/electrical/">Electrical</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/groundstation/">Groundstation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/embedded/">Embedded Software</a>
                </li>
                <li class="">
                    
    <a class="" href="../../bootcamp/rccompetition/">RC Car Competition</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorials</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../tutorials/git/">Git and Github</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tutorials/shell/">Using the terminal</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Groundstation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../groundstation/">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/what-you-need-to-know/">What you need to know</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/installation/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/tutorial/">Tutorial</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/project-structure/">Project Structure</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/contributing/">Contributing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/documenting/">Documenting</a>
                </li>
                <li class="">
                    
    <a class="" href="../../groundstation/resources/">Additional Resources</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">ZeroPilot</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../zeropilot/">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../zeropilot/pinout_reference/">Pinout Reference</a>
                </li>
                <li class="">
                    
    <a class="" href="../../zeropilot/hardware/">Hardware</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Network</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../network/data_relay/">Data Relay</a>
                </li>
                <li class="">
                    
    <a class="" href="../../network/multi_echo/">Multi Echo</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Computer Vision</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../computer-vision/">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Installation/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Building-the-project-[Linux]/">Building the project [Linux]</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Building-the-project-[Windows]/">Building the project [Windows]</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Coding-Conventions/">Coding Conventions</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Contributing/">Contributing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Using-the-WARG-server-environment/">Using the WARG computer environment</a>
                </li>
                <li class="">
                    
    <a class="" href="../../computer-vision/Writing-Tests/">Writing Tests</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Mechanical</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../mechanical/">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanical/cad-guidelines/">CAD Guidelines</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanical/3d-printing-guidelines/">3D Printing Guidelines</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanical/grabcad/">GrabCad</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">PicPilot</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../">Table of Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../pid-loops/">PID Loops</a>
                </li>
                <li class="">
                    
    <a class="" href="../pwm-io/">PWM and IO</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">UART</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#uart">UART</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#in-the-code">In the code</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../spi/">SPI</a>
                </li>
                <li class="">
                    
    <a class="" href="../direct-memory-access/">Direct Memory Access</a>
                </li>
                <li class="">
                    
    <a class="" href="../i2c/">I2C</a>
                </li>
                <li class="">
                    
    <a class="" href="../datalink/">Datalink</a>
                </li>
                <li class="">
                    
    <a class="" href="../analog-to-digital-converter/">Analog to Digital Converter</a>
                </li>
                <li class="">
                    
    <a class="" href="../sensors-and-peripherals/">Sensors and Peripherals</a>
                </li>
                <li class="">
                    
    <a class="" href="../attitude-control/">Attitude Control</a>
                </li>
                <li class="">
                    
    <a class="" href="../path-management/">Path Management</a>
                </li>
                <li class="">
                    
    <a class="" href="../resources/">Resources</a>
                </li>
                <li class="">
                    
    <a class="" href="../faq/">FAQ</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">WARG Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>PicPilot &raquo;</li>
        
      
    
    <li>UART</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/UWARG/edit/master/docs/picpilot/uart.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="uart">UART</h1>
<p>UART stands for Universal Asynchronous Receive Transmit. It is a protocol for chips to be able to communicate between on another. It is a serial form of communication, where each bit of data is transmitted along the same connection. The minimum hardware requirements look like this:</p>
<p><img alt="UART Communication" src="http://i.imgur.com/XtuUHVi.gif" /></p>
<p>Note that Tx represents the transmit port, Rx represents the receive port, and the GND represents the required ground connection.</p>
<p>UART is convenient due to its simplicity. Note that the interface does not have a clock line or any special signalling channels. Most other methods of communication require a pulsing clock to determine the rate at which data is transferred from one component to another. UART is "asynchronous" and therefore the bits on the transfer line and the receive line do not need to be transmitted at the same instance in time. Instead, both chips have a predefined rate at which they transfer binary information to one another. This predefined rate is often determined by the user, or sometimes (very rarely) restricted by the manufacturer. This rate is referred to as the <strong>baud rate</strong>. It is very similar to a bit rate.</p>
<p>As a side note (don't worry if you are confused), Bit rate is the number of <em>bits_transferred per second. Baud rate is the number of _symbols</em> transferred per second. A bit can be 0 or 1. A symbol carries different amounts of information in different technologies. For instance, in certain communication protocols, there can be 64 possible values for a single symbol. 64 values required 6 bits to be represented. Therefore, the baud rate is 6 times less than the bit rate.</p>
<p>For the UART communication protocol, the baud rate is equivalent to the bit rate, although "baud" is the correct terminology.</p>
<p>Although UART can be used in both 8 bit mode and 16 bit mode, the PICpilot uses the 8 bit mode of communication as displayed below.</p>
<ol>
<li>First a start bit is sent</li>
<li>The message is then relayed in series</li>
<li>The stop bit(s) are then sent. (There can be 1 or 2 stop bits)</li>
</ol>
<p>The stop and end bits indicate the beginning and the end of communication.</p>
<table>
<thead>
<tr>
<th><strong>Bit number</strong></th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
<th>11</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><strong>Start bit</strong></td>
<td><strong>5–8 data bits</strong></td>
<td><strong>Stop bit(s)</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>Start</td>
<td>Data 0</td>
<td>Data 1</td>
<td>Data 2</td>
<td>Data 3</td>
<td>Data 4</td>
<td>Data 5</td>
<td>Data 6</td>
<td>Data 7</td>
<td>Stop</td>
<td></td>
</tr>
</tbody>
</table>
<p><img alt="UART Scope" src="http://i.imgur.com/Y6wtYli.jpg" /></p>
<p>The most common settings for the UART protocol include 8 data bits, no parity, 1 stop bit, and no flow control. Remember to make sure that the baud rate matches up, and NEVER connect Tx to Tx or Rx to Rx.</p>
<p>In case you do not know, parity is a special bit used to check the integrity of the data sent. It indicates whether or not the sum of the 8 bits must be odd or even. If this result does not match the parity bit, the microcontroller would know that the information is garbled.</p>
<p>Secondly, flow control requires additional pins, where each peripheral signals the other one before it transmits and receives. This ensures that both chips are ready to communicate.</p>
<p>Thirdly, the terms full duplex and half duplex refer to a chip being able to multitask. Full duplex indicates that both chips send and receive at the same time. Half duplex indicates that only one chip sends and receives at a time. Usually, some type of flow control is required for half duplex systems.</p>
<p>This form of communication is used for two purposes on the PICpilot. It is used for the data link, as well as the debugging interface. The settings are listed below.</p>
<h2 id="in-the-code">In the code</h2>
<p>Each dspic33fj256gp710a has two UART interfaces. They are labeled UART1 and UART2. In the code, two corresponding files are present: UART1.c and UART2.c (as well as their header files). UART1 and UART2 have nearly the same configuration settings, but with slight discrepancies. UART1 is used for debugging purposes. UART2 is used for the wireless transmitter (datalink).</p>
<p>For detailed register maps and specifications of the UART interface, see the <a href="http://www.microchip.com/wwwproducts/Devices.aspx?product=dsPIC33FJ256GP710A">dspic33fj256gp710A</a> datasheet.</p>
<p>The most important settings are listed below.</p>
<h3 id="uart1">UART1</h3>
<pre><code>U1MODEbits.UEN = 0;

U1MODEbits.PDSEL = 0b00;

U1MODEbits.STSEL = 0;

U1BRG = 1;

IPC7 = 0x4400;

IFS0bits.U1TXIF = 0;                // Clear the Transmit Interrupt Flag

IEC0bits.U1TXIE = 0;        // Enable Transmit Interrupts

IFS0bits.U1RXIF = 0;                // Clear the Recieve Interrupt Flag

IEC0bits.U1RXIE = 0;        // Enable Recieve Interrupts

U1MODEbits.UARTEN = 1;        //Enable UART

U1STAbits.UTXEN = 1;        //This must be set after UARTEN - This allows UART to control the Tx pin.
</code></pre>
<table>
<thead>
<tr>
<th>Register</th>
<th>Value</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>U1MODEbits.UEN</td>
<td>0</td>
<td>Enables the Rx and Tx pins and disables the CTS and RTS pins.</td>
</tr>
<tr>
<td>U1MODEbits.PDSEL</td>
<td>0</td>
<td>Configures 8 bit messages with no parity bits.</td>
</tr>
<tr>
<td>U1MODEbits.STSEL</td>
<td>0</td>
<td>Configures 1 stop bit.</td>
</tr>
<tr>
<td>U1BRG</td>
<td>1</td>
<td>Sets the Baud Rate to 115200 Baud.</td>
</tr>
<tr>
<td>IPC7</td>
<td>17408</td>
<td>Sets the priority level for UART interrupts.</td>
</tr>
<tr>
<td>IFS0bits.U1TXIF</td>
<td>0</td>
<td>Clears the transmit interrupt flag.</td>
</tr>
<tr>
<td>IEC0bits.U1TXIE</td>
<td>0</td>
<td>Enables the transmit interrupt event.</td>
</tr>
<tr>
<td>IFS0bits.U1RXIF</td>
<td>0</td>
<td>Clears the receive interrupt flag.</td>
</tr>
<tr>
<td>IEC0bits.U1TXIE</td>
<td>0</td>
<td>Enables the receive interrupt event.</td>
</tr>
<tr>
<td>U1MODEbits.UARTEN</td>
<td>1</td>
<td>Turns UART on.</td>
</tr>
<tr>
<td>U1STAbits.UTXEN</td>
<td>1</td>
<td>Allows transmission (Tx) to take place.</td>
</tr>
</tbody>
</table>
<h3 id="uart2">UART2</h3>
<pre><code>U2MODEbits.UEN = 0;

U2MODEbits.PDSEL = 0b00;

U2MODEbits.STSEL = 0;

U2BRG = 5;

IPC7 = 0x4400;

IFS1bits.U2TXIF = 0;                // Clear the Transmit Interrupt Flag

IEC1bits.U2TXIE = 0;        // Enable Transmit Interrupts

IFS1bits.U2RXIF = 0;                // Clear the Recieve Interrupt Flag

IEC1bits.U2RXIE = 0;        // Enable Recieve Interrupts

U2MODEbits.UARTEN = 1;        //Enable UART

U2STAbits.UTXEN = 1;        //This must be set after UARTEN - This allows UART to control the Tx pin.
</code></pre>
<table>
<thead>
<tr>
<th>Register</th>
<th>Value</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>U1MODEbits.UEN</td>
<td>0</td>
<td>Enables the Rx and Tx pins and disables the CTS and RTS pins.</td>
</tr>
<tr>
<td>U1MODEbits.PDSEL</td>
<td>0</td>
<td>Configures 8 bit messages with no parity bits.</td>
</tr>
<tr>
<td>U1MODEbits.STSEL</td>
<td>0</td>
<td>Configures 1 stop bit.</td>
</tr>
<tr>
<td>U1BRG</td>
<td>5</td>
<td>Sets the Baud Rate to 38400 Baud.</td>
</tr>
<tr>
<td>IPC7</td>
<td>17408</td>
<td>Sets the priority level for UART interrupts.</td>
</tr>
<tr>
<td>IFS0bits.U1TXIF</td>
<td>0</td>
<td>Clears the transmit interrupt flag.</td>
</tr>
<tr>
<td>IEC0bits.U1TXIE</td>
<td>0</td>
<td>Enables the transmit interrupt event.</td>
</tr>
<tr>
<td>IFS0bits.U1RXIF</td>
<td>0</td>
<td>Clears the receive interrupt flag.</td>
</tr>
<tr>
<td>IEC0bits.U1TXIE</td>
<td>0</td>
<td>Enables the receive interrupt event.</td>
</tr>
<tr>
<td>U1MODEbits.UARTEN</td>
<td>1</td>
<td>Turns UART on.</td>
</tr>
<tr>
<td>U1STAbits.UTXEN</td>
<td>1</td>
<td>Allows transmission (Tx) to take place.</td>
</tr>
</tbody>
</table>
<p>Note that the only difference between the data link (UART2) and the debugging interface (UART1), is the rate at which information is sent (baud rate).</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../spi/" class="btn btn-neutral float-right" title="SPI">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../pwm-io/" class="btn btn-neutral" title="PWM and IO"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright <a href="http://www.uwarg.com"> University of Waterloo Aerial Robotics Group</a></p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/UWARG/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../pwm-io/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../spi/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>
      <script src="../../sloth-generator.js"></script>

</body>
</html>
